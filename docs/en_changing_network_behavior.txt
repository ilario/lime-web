---
---
Changing network interface behavior
===================================

== LibreMesh network config

Most of the LibreMesh configuration is handled by a unified configuration file placed on **/etc/config/lime**.
This file is part of the https://openwrt.org/docs/guide-user/base-system/uci[UCI] database which unifies also most of the OpenWrt configuration files.
For applying the changes to the +/etc/config/lime+ configuration file, the _lime-config_ script has to be invoked executing +lime-config+ in the node's root terminal.

In addition to _/etc/config/lime_ there exist also _/etc/config/lime-defaults_. 
If a configuration option is not found in +/etc/config/lime+, the +/etc/config/lime-defaults+ one will be used when running the _lime-config_ command.

[NOTE]
.lime config file
=================
The idea behind this structure is that the user **only** modifies _/etc/config/lime_ but never _/etc/config/lime-defaults_.

Once the file is modified the command _lime-config_ must be run. To enable the changes you might reboot the node (**reboot** command).
=================

The networking options of _/etc/config/lime_ are defined in two different blocks.

== Device-wide network options

If there is not a specific network section for a specific network device, the options from the common section will be used.

For a detailed view of the config file common options see link:/docs/en_config.html[config].

== Specific ethernet interface configuration

If we want to change the default behavior of just one network interface of the many that are present in a router, we can define a specific configuration.

.Ethernet specific options, multiple allowed
----
config net port5
	option linux_name 'eth1.5'
	list protocols 'wan'
----

In this case the eth1.5 interface will be used as WAN (so the DHCP client will be enabled).

[NOTE]
.config net
================
Do not put any "." in the section name.

As linux_name, use the actual name of the interface as the system shows (check with +ip link show+).

Some of the available protocols require the relative package, for example "lime-proto-wan", to be installed.
================

[NOTE]
.Network interface specific options
=======================
Available protocols: bmx6, bmx7, batadv, olsr, olsr6, olsr2, bgp, wan, lan, manual, static, babeld, apbb, client

proto:vlan_number works too (something like bmx6:13 is supported). If VLAN is 0, no VLAN will be used.

If you use manual do not specify other protocols, may result in an unpredictable behavior/configuration.
=======================

[NOTE]
.WAN autoconfiguration
=================
If the LibreMesh package **lime-hwd-openwrt-wan** is installed and your node have two or more ethernet ports, 
LibreMesh might autoconfigure as WAN one of these network ethernet device.

In this case there will be a new specific configuration section like this one: 
----
config net 'lm_hwd_openwrt_wan'
	option autogenerated 'true'
----

If we want to change the behavior of this specific network interface, we must set autogenerated to **false**.
=================

== Ground routing configuration

For more information on ground routing concept, check out https://github.com/libremesh/lime-packages/issues/443[these resources].

.Ground routing specific sections
----
config hwd_gr link1
	option net_dev 'eth0'
	option vlan '5'
	option switch_dev 'switch0'
	option switch_cpu_port '0'
	list switch_ports '4'
----

[NOTE]
.config hwd_gr
===============
* net_dev: Plain ethernet device on top of which 802.1q VLAN will be constructed.

* vlan: VLAN ID to use for this ground routing link, use little one because cheap switch doesn't supports big IDs, this will be used also as 802.1q VID.

* switch_dev: These options regarding switch need to be set only if your ethernet device is connected to a switch chip. If the switch exists you can read its name (like switch0) in +/etc/config/network+ file.

* switch_cpu_port: Refer to switch port map of your device on https://openwrt.org/toh/start[OpenWrt ToH] to know CPU port index.

* switch_ports: List switch ports on which you want the VLAN being passed, refer to https://openwrt.org/toh/start[OpenWrt ToH] for correspondence with physical ports.
===============

[NOTE]
==============
One section for each ground routing link.
With ground routing we mean setups having LibreMesh on a router which is connected via cable(s), eventually through a switch, to some wireless routers running the original firmware in WDS (transparent bridge) Ap/Sta mode.
Likely you want to configure as many sections of ground routing with different VLAN numbers or different switch ports as many connected devices in WDS mode.
==============

== BGP configuration

.Proto BGP specific sections (one section for each BGP peer)
----
config bgp_peer peer1
	option remoteIP '192.0.2.6'
	option remoteAS '65550'

config bgp_peer peer2
	option remoteIP '2001:db8::c001'
	option remoteAS '65549'
----

For documentation on BGP configuration see link:http://nicolasacco.diveni.re/~gio/internship-report/main.html#proto:bgp[this thesis].

== Specific wireless interface configuration

See link:en_change_wifi_behavior.help[Change WiFi behavior] page.
